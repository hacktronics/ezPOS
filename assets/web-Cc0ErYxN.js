import{W as u,C as o,z as d,A as m}from"./index-DZpm7Dsx.js";class h extends u{async getPhoto(r){return new Promise(async(t,a)=>{if(r.webUseInput||r.source===o.Photos)this.fileInputExperience(r,t,a);else if(r.source===o.Prompt){let e=document.querySelector("pwa-action-sheet");e||(e=document.createElement("pwa-action-sheet"),document.body.appendChild(e)),e.header=r.promptLabelHeader||"Photo",e.cancelable=!1,e.options=[{title:r.promptLabelPhoto||"From Photos"},{title:r.promptLabelPicture||"Take Picture"}],e.addEventListener("onSelection",async e=>{0===e.detail?this.fileInputExperience(r,t,a):this.cameraExperience(r,t,a)})}else this.cameraExperience(r,t,a)})}async pickImages(e){return new Promise(async(e,t)=>{this.multipleFileInputExperience(e,t)})}async cameraExperience(t,a,r){if(customElements.get("pwa-camera-modal")){const n=document.createElement("pwa-camera-modal");n.facingMode=t.direction===d.Front?"user":"environment",document.body.appendChild(n);try{await n.componentOnReady(),n.addEventListener("onPhoto",async e=>{e=e.detail;null===e?r(new m("User cancelled photos app")):e instanceof Error?r(e):a(await this._getCameraPhoto(e,t)),n.dismiss(),document.body.removeChild(n)}),n.present()}catch(e){this.fileInputExperience(t,a,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(t,a,r)}fileInputExperience(n,i,t){let s=document.querySelector("#_capacitor-camera-input");const c=()=>{var e;null!=(e=s.parentNode)&&e.removeChild(s)};s||((s=document.createElement("input")).id="_capacitor-camera-input",s.type="file",s.hidden=!0,document.body.appendChild(s),s.addEventListener("change",e=>{var t=s.files[0];let a="jpeg";if("image/png"===t.type?a="png":"image/gif"===t.type&&(a="gif"),"dataUrl"===n.resultType||"base64"===n.resultType){const r=new FileReader;r.addEventListener("load",()=>{var e;"dataUrl"===n.resultType?i({dataUrl:r.result,format:a}):"base64"===n.resultType&&(e=r.result.split(",")[1],i({base64String:e,format:a})),c()}),r.readAsDataURL(t)}else i({webPath:URL.createObjectURL(t),format:a}),c()}),s.addEventListener("cancel",e=>{t(new m("User cancelled photos app")),c()})),s.accept="image/*",s.capture=!0,n.source===o.Photos||n.source===o.Prompt?s.removeAttribute("capture"):n.direction===d.Front?s.capture="user":n.direction===d.Rear&&(s.capture="environment"),s.click()}multipleFileInputExperience(t,a){let n=document.querySelector("#_capacitor-camera-input-multiple");const i=()=>{var e;null!=(e=n.parentNode)&&e.removeChild(n)};n||((n=document.createElement("input")).id="_capacitor-camera-input-multiple",n.type="file",n.hidden=!0,n.multiple=!0,document.body.appendChild(n),n.addEventListener("change",e=>{var a=[];for(let t=0;t<n.files.length;t++){var r=n.files[t];let e="jpeg";"image/png"===r.type?e="png":"image/gif"===r.type&&(e="gif"),a.push({webPath:URL.createObjectURL(r),format:e})}t({photos:a}),i()}),n.addEventListener("cancel",e=>{a(new m("User cancelled photos app")),i()})),n.accept="image/*",n.click()}_getCameraPhoto(e,i){return new Promise((t,a)=>{const r=new FileReader,n=e.type.split("/")[1];"uri"===i.resultType?t({webPath:URL.createObjectURL(e),format:n,saved:!1}):(r.readAsDataURL(e),r.onloadend=()=>{var e=r.result;"dataUrl"===i.resultType?t({dataUrl:e,format:n,saved:!1}):t({base64String:e.split(",")[1],format:n,saved:!1})},r.onerror=e=>{a(e)})})}async checkPermissions(){if("u"<typeof navigator||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch(e){throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const y=new h;export{y as Camera,h as CameraWeb};
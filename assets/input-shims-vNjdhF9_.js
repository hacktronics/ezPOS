import{d as A,K as O,l as P,m as B,k as p,j as F,o as H,q as y,t as q,u as U,v as Y}from"./index-DZpm7Dsx.js";const D=new WeakMap,T=(e,t,o,n=0,i=!1)=>{D.has(e)!==o&&(o?G(e,t,n,i):W(e,t))},$=e=>e===e.getRootNode().activeElement,G=(e,t,o,n=!1)=>{var i=t.parentNode,r=t.cloneNode(!1),n=(r.classList.add("cloned-input"),r.tabIndex=-1,n&&(r.disabled=!0),i.appendChild(r),D.set(e,r),"rtl"===e.ownerDocument.dir?9999:-9999);e.style.pointerEvents="none",t.style.transform="translate3d(".concat(n,"px,").concat(o,"px,0) scale(0)")},W=(e,t)=>{var o=D.get(e);o&&(D.delete(e),o.remove()),e.style.pointerEvents="",t.style.transform=""},N=50,j=(t,o,e)=>{if(!e||!o)return()=>{};const n=e=>{$(o)&&T(t,o,e)},i=()=>T(t,o,!1),r=()=>n(!0),a=()=>n(!1);return P(e,"ionScrollStart",r),P(e,"ionScrollEnd",a),o.addEventListener("blur",i),()=>{B(e,"ionScrollStart",r),B(e,"ionScrollEnd",a),o.removeEventListener("blur",i)}},I="input, textarea, [no-blur], [contenteditable]",z=()=>{let o=!0,n=!1;const i=document,e=()=>{n=!0},t=()=>{o=!0},r=e=>{if(n)n=!1;else{const t=i.activeElement;!t||t.matches(I)||(e=e.target)===t||e.matches(I)||e.closest(I)||(o=!1,setTimeout(()=>{o||t.blur()},50))}};return P(i,"ionScrollStart",e),i.addEventListener("focusin",t,!0),i.addEventListener("touchend",r,!1),()=>{B(i,"ionScrollStart",e,!0),i.removeEventListener("focusin",t,!0),i.removeEventListener("touchend",r,!1)}},J=.3,Q=(e,t,o,n)=>{var i=null!=(i=e.closest("ion-item,[ion-item]"))?i:e;return V(i.getBoundingClientRect(),t.getBoundingClientRect(),o,n)},V=(e,t,o,n)=>{var i=e.top,e=e.bottom,r=t.top,a=r+15,t=Math.min(t.bottom,n-o)-N-e,n=a-i,e=Math.round(t<0?-t:0<n?-n:0),t=Math.min(e,i-r),n=Math.abs(t)/J;return{scrollAmount:t,scrollDuration:Math.min(400,Math.max(150,n)),scrollPadding:o,inputSafeY:4-(i-a)}},R="$ionPaddingTimer",M=(e,t,o)=>{var n=e[R];n&&clearTimeout(n),0<t?e.style.setProperty("--keyboard-offset","".concat(t,"px")):e[R]=setTimeout(()=>{e.style.setProperty("--keyboard-offset","0px"),o&&o()},120)},_=(e,t,o)=>{e.addEventListener("focusout",()=>{t&&M(t,0,o)},{once:!0})};let g=0;const K="data-ionic-skip-scroll-assist",X=(t,o,n,i,e,r,a,s=!1)=>{const d=r&&(void 0===a||a.mode===H.None);let l=!1;const c=void 0!==y?y.innerHeight:0,u=e=>{!1===l?l=!0:k(t,o,n,i,e.detail.keyboardHeight,d,s,c,!1)},v=()=>{l=!1,null!=y&&y.removeEventListener("ionKeyboardDidShow",u),t.removeEventListener("focusout",v,!0)},m=async()=>{o.hasAttribute(K)?o.removeAttribute(K):(k(t,o,n,i,e,d,s,c),null!=y&&y.addEventListener("ionKeyboardDidShow",u),t.addEventListener("focusout",v,!0))};return t.addEventListener("focusin",m,!0),()=>{t.removeEventListener("focusin",m,!0),null!=y&&y.removeEventListener("ionKeyboardDidShow",u),t.removeEventListener("focusout",v,!0)}},C=e=>{document.activeElement!==e&&(e.setAttribute(K,"true"),e.focus())},k=async(t,o,n,i,r,a,e=!1,s=0,d=!0)=>{if(n||i){const l=Q(t,n||i,r,s);if(n&&Math.abs(l.scrollAmount)<4)C(o),a&&null!==n&&(M(n,g),_(o,n,()=>g=0));else if(T(t,o,!0,l.inputSafeY,e),C(o),q(()=>t.click()),a&&n&&(g=l.scrollPadding,M(n,g)),typeof window<"u"){let e;const c=async()=>{void 0!==e&&clearTimeout(e),window.removeEventListener("ionKeyboardDidShow",u),window.removeEventListener("ionKeyboardDidShow",c),n&&await Y(n,0,l.scrollAmount,l.scrollDuration),T(t,o,!1,l.inputSafeY),C(o),a&&_(o,n,()=>g=0)},u=()=>{window.removeEventListener("ionKeyboardDidShow",u),window.addEventListener("ionKeyboardDidShow",c)};if(n){i=await U(n),r=i.scrollHeight-i.clientHeight;if(d&&l.scrollAmount>r-i.scrollTop)return"password"===o.type?(l.scrollAmount+=N,window.addEventListener("ionKeyboardDidShow",u)):window.addEventListener("ionKeyboardDidShow",c),void(e=setTimeout(c,1e3))}c()}}},Z=!0,te=async(e,t)=>{if(void 0!==A){const o="ios"===t,r="android"===t,a=e.getNumber("keyboardHeight",290),s=e.getBoolean("scrollAssist",!0),d=e.getBoolean("hideCaretOnScroll",o),n=e.getBoolean("inputBlurring",o),l=e.getBoolean("scrollPadding",!0),i=Array.from(A.querySelectorAll("ion-input, ion-textarea")),c=new WeakMap,u=new WeakMap,v=await O.getResizeMode(),m=async t=>{await new Promise(e=>p(t,e));var e,o=t.shadowRoot||t,o=o.querySelector("input")||o.querySelector("textarea"),n=F(t),i=n?null:t.closest("ion-footer");o&&(n&&d&&!c.has(t)&&(e=j(t,o,n),c.set(t,e)),"date"!==o.type)&&"datetime-local"!==o.type&&(n||i)&&s&&!u.has(t)&&(e=X(t,o,n,i,a,l,v,r),u.set(t,e))};n&&Z&&z();for(const y of i)m(y);A.addEventListener("ionInputDidLoad",e=>{m(e.detail)}),A.addEventListener("ionInputDidUnload",e=>{var t;e=e.detail,d&&((t=c.get(e))&&t(),c.delete(e)),s&&((t=u.get(e))&&t(),u.delete(e))})}};export{te as startInputShims};
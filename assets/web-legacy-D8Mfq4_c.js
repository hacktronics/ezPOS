System.register(["./index-legacy-CkvIY1Fm.js"],function(t,e){"use strict";var r,i;return{setters:[e=>{r=e.B,i=e.W}],execute:function(){class e{constructor(){this.isExists=!1,this.retExists={isExists:!1,pathWasm:""},this.initSqlJs=require("sql.js"),this.OS=require("os"),this.FS=require("fs"),this.Path=require("path")}getTypeOrmDBFolder(){var e=__dirname.indexOf("node_modules"),e=__dirname.slice(0,e),e=this.Path.basename(e),t=this.Path.join(this.OS.homedir(),"Documents"),t=this.Path.join(t,"CapacitorSQLite",e);return this.FS.mkdirSync(t,{recursive:!0}),t}getTypeOrmDBPath(e,t){return this.Path.resolve(e,t)}async checkFileExistence(t){var e=await this.checkFolderExistence("public")?"public":"src",e=this.Path.join(e,t),t={};t.pathWasm=e;try{return this.FS.existsSync(e)?t.isExists=!0:t.isExists=!1,Promise.resolve(t)}catch(e){return t.isExists=!1,Promise.resolve(t)}}async checkFolderExistence(e){try{return this.FS.existsSync(e)?Promise.resolve(!0):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}async openOrCreateDatabase(e,t){let s;const r="OpenOrCreateDatabase";try{this.retExists=await this.checkFileExistence(e),this.isExists=this.retExists.isExists}catch(e){this.isExists=!1}if(!this.isExists)return Promise.reject(r+" No sql-wasm.wasm found in "+e);try{const e={locateFile:e=>this.retExists.pathWasm+"/"+e},r=await this.initSqlJs(e);if(this.FS.existsSync(t)){const e=this.FS.readFileSync(t);s=new r.Database(e)}else s=new r.Database;return Promise.resolve(s)}catch(e){return Promise.reject(r+" open database failed")}}async saveDatabase(e,t){try{var s=e.export();return this.FS.writeFileSync(t,r.from(s)),Promise.resolve()}catch(e){return Promise.reject(e)}}closeDB(t){try{return t.close(),Promise.resolve()}catch(e){const t=e.message||e;return Promise.reject("closeDB "+t)}}async dbChanges(t){var e;try{return e=t.exec("SELECT total_changes()")[0].values[0][0],Promise.resolve(e)}catch(e){const t=e.message||e;return Promise.reject("DbChanges failed: "+t)}}async getLastId(t){var e;try{return e=t.exec("SELECT last_insert_rowid()")[0].values[0][0],Promise.resolve(e)}catch(e){const t=e.message||e;return Promise.reject(new Error("GetLastId failed: "+t))}}async execute(t,e){try{t.exec(e);var s=await this.dbChanges(t);return Promise.resolve(s)}catch(e){const t=e.message||e;return Promise.reject(new Error("Execute failed: "+t))}}async run(t,e,s,r){let i,n=[];var a={};try{i=0<s.length?t.exec(e,s):t.exec(e),"all"!==r&&"one"!==r||i&&0<i.length&&(n=this.getReturnedValues(i[0],r));var o=await this.getLastId(t);return a.lastId=o,null!=n&&0<n.length&&(a.values=n),Promise.resolve(a)}catch(e){const t=e.message||e;return Promise.reject(new Error("Run failed: "+t))}}getReturnedValues(t,e){var s=[];for(const i of t.values){var r={};for(let e=0;e<t.columns.length;e++)r[t.columns[e]]=i[e];if(s.push(r),"one"===e)break}return s}async queryAll(t,s,r){try{let e=[];var i;return 0==(e=null!=r&&0<r.length?t.exec(s,r):t.exec(s)).length?Promise.resolve([]):(i=e[0].values.map(s=>{const r={};return e[0].columns.forEach((e,t)=>{r[""+e]=s[t]}),r}),Promise.resolve(i))}catch(e){const t=e.message||e;return Promise.reject(new Error("queryAll: "+t))}}}class s{constructor(){this.wasmPath="assets",this.sqliteUtil=new e,this.typeOrmDBFolder=this.sqliteUtil.getTypeOrmDBFolder(),this.dbPath="",this.mDb=null,this._isDBOpen=!1}async open(e){try{return this.dbPath=this.sqliteUtil.getTypeOrmDBPath(this.typeOrmDBFolder,e+"SQLite.db"),this.mDb=await this.sqliteUtil.openOrCreateDatabase(this.wasmPath,this.dbPath),this._isDBOpen=!0,Promise.resolve()}catch(e){return Promise.reject("Open: "+e)}}async close(){try{return this._isDBOpen&&(await this.sqliteUtil.saveDatabase(this.mDb,this.dbPath),await this.mDb.close()),Promise.resolve()}catch(e){return Promise.reject("Close: "+e)}}async executeSQL(e){let t=-1;try{if(this._isDBOpen){var s=await this.sqliteUtil.dbChanges(this.mDb);if((t=await this.sqliteUtil.execute(this.mDb,e))<0)return Promise.reject(new Error("ExecuteSQL: changes < 0"));t=await this.sqliteUtil.dbChanges(this.mDb)-s}return Promise.resolve(t)}catch(e){return Promise.reject("ExecuteSQL: "+e)}}async run(e,t,s){var r={changes:-1,lastId:-1};try{if(this._isDBOpen){var i=await this.sqliteUtil.dbChanges(this.mDb),n=await this.sqliteUtil.run(this.mDb,e,t,s),a=n.lastId;if(a<0)return Promise.reject(new Error("RunSQL: lastId < 0"));var o=await this.sqliteUtil.dbChanges(this.mDb)-i;r.changes=o,r.lastId=a,r.values=n.values||[]}return Promise.resolve({changes:r})}catch(e){return Promise.reject("Run: "+e)}}async selectSQL(e,t){let s=[];try{return this._isDBOpen&&(s=await this.sqliteUtil.queryAll(this.mDb,e,t)),Promise.resolve({values:s})}catch(e){return Promise.reject("SelectSQL: "+e)}}}t("CapacitorSQLiteWeb",class extends i{constructor(){super(...arguments),this.jeepSqliteElement=null,this.isWebStoreOpen=!1,this.databases={}}async initWebStore(){await customElements.whenDefined("jeep-sqlite"),this.jeepSqliteElement=document.querySelector("jeep-sqlite"),this.ensureJeepSqliteIsAvailable(),this.jeepSqliteElement.addEventListener("jeepSqliteImportProgress",e=>{this.notifyListeners("sqliteImportProgressEvent",e.detail)}),this.jeepSqliteElement.addEventListener("jeepSqliteExportProgress",e=>{this.notifyListeners("sqliteExportProgressEvent",e.detail)}),this.jeepSqliteElement.addEventListener("jeepSqliteHTTPRequestEnded",e=>{this.notifyListeners("sqliteHTTPRequestEndedEvent",e.detail)}),this.jeepSqliteElement.addEventListener("jeepSqlitePickDatabaseEnded",e=>{this.notifyListeners("sqlitePickDatabaseEndedEvent",e.detail)}),this.jeepSqliteElement.addEventListener("jeepSqliteSaveDatabaseToDisk",e=>{this.notifyListeners("sqliteSaveDatabaseToDiskEvent",e.detail)}),this.isWebStoreOpen||(this.isWebStoreOpen=await this.jeepSqliteElement.isStoreOpen())}async saveToStore(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.saveToStore(e)}catch(e){throw new Error(""+e)}}async getFromLocalDiskToStore(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.getFromLocalDiskToStore(e)}catch(e){throw new Error(""+e)}}async saveToLocalDisk(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.saveToLocalDisk(e)}catch(e){throw new Error(""+e)}}async echo(e){return this.ensureJeepSqliteIsAvailable(),this.jeepSqliteElement.echo(e)}async createConnection(e){if("undefined"!=typeof window&&window.document){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.createConnection(e)}catch(e){throw new Error(""+e)}}else{if(!Object.keys(e).includes("database"))throw new Error("Must provide a database name");var e="RW_"+e.database,t=new s;this.databases[e]=t}}async open(e){if("undefined"!=typeof window&&window.document){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.open(e)}catch(e){throw new Error(""+e)}}else{e=e.database||"";if(0===e.length)throw new Error("Must provide a database name");var t=this.getDatabaseConnectionOrThrowError("RW_"+e);try{await t.open(e)}catch(e){throw new Error("### open "+e)}}}async closeConnection(e){if("undefined"!=typeof window&&window.document){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.closeConnection(e)}catch(e){throw new Error(""+e)}}else{e=e.database||"";if(0===e.length)throw new Error("Must provide a database name");var e="RW_"+e,t=this.getDatabaseConnectionOrThrowError(e);try{await t.close(),delete this.databases[e]}catch(e){throw new Error("### closeConnection "+e)}}}async getVersion(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.getVersion(e)}catch(e){throw new Error(""+e)}}async checkConnectionsConsistency(e){this.ensureJeepSqliteIsAvailable();try{return await this.jeepSqliteElement.checkConnectionsConsistency(e)}catch(e){throw new Error(""+e)}}async close(e){if("undefined"!=typeof window&&window.document){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.close(e)}catch(e){throw new Error(""+e)}}else{e=e.database||"";if(0===e.length)throw new Error("Must provide a database name");e=this.getDatabaseConnectionOrThrowError("RW_"+e);try{await e.close()}catch(e){throw new Error("### close "+e)}}}async beginTransaction(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.beginTransaction(e)}catch(e){throw new Error(""+e)}}async commitTransaction(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.commitTransaction(e)}catch(e){throw new Error(""+e)}}async rollbackTransaction(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.rollbackTransaction(e)}catch(e){throw new Error(""+e)}}async isTransactionActive(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isTransactionActive(e)}catch(e){throw new Error(""+e)}}async getTableList(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.getTableList(e)}catch(e){throw new Error(""+e)}}async execute(e){if("undefined"!=typeof window&&window.document){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.execute(e)}catch(e){throw new Error(""+e)}}else{var t=e.database||"";if(0===t.length)throw new Error("Must provide a database name");var s=e.statements||"";if(0===s.length)return Promise.reject("Must provide raw SQL statements");t=this.getDatabaseConnectionOrThrowError("RW_"+t);try{const e=await t.executeSQL(s);return{changes:{changes:e}}}catch(e){throw new Error(""+e)}}}async executeSet(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.executeSet(e)}catch(e){throw new Error(""+e)}}async run(e){if("undefined"!=typeof window&&window.document){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.run(e)}catch(e){throw new Error(""+e)}}else{var t=e.database||"";if(0===t.length)throw new Error("Must provide a database name");var s=e.statement||"";if(0===s.length)return Promise.reject("Must provide raw SQL statement");var r=e.values||[],e=e.returnMode||"no",t=this.getDatabaseConnectionOrThrowError("RW_"+t);try{return await t.run(s,r,e)}catch(e){throw new Error(""+e)}}}async query(e){if("undefined"!=typeof window&&window.document){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.query(e)}catch(e){throw new Error(""+e)}}else{var t=e.database||"";if(0===t.length)throw new Error("Must provide a database name");var s=e.statement||"";if(0===s.length)return Promise.reject("Must provide raw SQL statement");e=e.values||[],t=this.getDatabaseConnectionOrThrowError("RW_"+t);try{return await t.selectSQL(s,e)}catch(e){throw new Error(""+e)}}}async isDBExists(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isDBExists(e)}catch(e){throw new Error(""+e)}}async isDBOpen(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isDBOpen(e)}catch(e){throw new Error(""+e)}}async isDatabase(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isDatabase(e)}catch(e){throw new Error(""+e)}}async isTableExists(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isTableExists(e)}catch(e){throw new Error(""+e)}}async deleteDatabase(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.deleteDatabase(e)}catch(e){throw new Error(""+e)}}async isJsonValid(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.isJsonValid(e)}catch(e){throw new Error(""+e)}}async importFromJson(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.importFromJson(e)}catch(e){throw new Error(""+e)}}async exportToJson(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.exportToJson(e)}catch(e){throw new Error(""+e)}}async createSyncTable(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.createSyncTable(e)}catch(e){throw new Error(""+e)}}async setSyncDate(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.setSyncDate(e)}catch(e){throw new Error(""+e)}}async getSyncDate(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.getSyncDate(e)}catch(e){throw new Error(""+e)}}async deleteExportedRows(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.deleteExportedRows(e)}catch(e){throw new Error(""+e)}}async addUpgradeStatement(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.addUpgradeStatement(e)}catch(e){throw new Error(""+e)}}async copyFromAssets(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.copyFromAssets(e)}catch(e){throw new Error(""+e)}}async getFromHTTPRequest(e){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{await this.jeepSqliteElement.getFromHTTPRequest(e)}catch(e){throw new Error(""+e)}}async getDatabaseList(){this.ensureJeepSqliteIsAvailable(),this.ensureWebstoreIsOpen();try{return await this.jeepSqliteElement.getDatabaseList()}catch(e){throw new Error(""+e)}}ensureJeepSqliteIsAvailable(){if(null===this.jeepSqliteElement)throw new Error("The jeep-sqlite element is not present in the DOM! Please check the @capacitor-community/sqlite documentation for instructions regarding the web platform.")}ensureWebstoreIsOpen(){if(!this.isWebStoreOpen)throw new Error('WebStore is not open yet. You have to call "initWebStore()" first.')}getDatabaseConnectionOrThrowError(e){if(Object.keys(this.databases).includes(e))return this.databases[e];throw new Error(`No connection available for database "${e}"`)}async getUrl(){throw this.unimplemented("Not implemented on web.")}async getMigratableDbList(e){throw console.log("getMigratableDbList",e),this.unimplemented("Not implemented on web.")}async addSQLiteSuffix(e){throw console.log("addSQLiteSuffix",e),this.unimplemented("Not implemented on web.")}async deleteOldDatabases(e){throw console.log("deleteOldDatabases",e),this.unimplemented("Not implemented on web.")}async moveDatabasesAndAddSuffix(e){throw console.log("moveDatabasesAndAddSuffix",e),this.unimplemented("Not implemented on web.")}async isSecretStored(){throw this.unimplemented("Not implemented on web.")}async setEncryptionSecret(e){throw console.log("setEncryptionSecret",e),this.unimplemented("Not implemented on web.")}async changeEncryptionSecret(e){throw console.log("changeEncryptionSecret",e),this.unimplemented("Not implemented on web.")}async clearEncryptionSecret(){throw console.log("clearEncryptionSecret"),this.unimplemented("Not implemented on web.")}async checkEncryptionSecret(e){throw console.log("checkEncryptionPassPhrase",e),this.unimplemented("Not implemented on web.")}async getNCDatabasePath(e){throw console.log("getNCDatabasePath",e),this.unimplemented("Not implemented on web.")}async createNCConnection(e){throw console.log("createNCConnection",e),this.unimplemented("Not implemented on web.")}async closeNCConnection(e){throw console.log("closeNCConnection",e),this.unimplemented("Not implemented on web.")}async isNCDatabase(e){throw console.log("isNCDatabase",e),this.unimplemented("Not implemented on web.")}async isDatabaseEncrypted(e){throw console.log("isDatabaseEncrypted",e),this.unimplemented("Not implemented on web.")}async isInConfigEncryption(){throw this.unimplemented("Not implemented on web.")}async isInConfigBiometricAuth(){throw this.unimplemented("Not implemented on web.")}async loadExtension(e){throw console.log("loadExtension",e),this.unimplemented("Not implemented on web.")}async enableLoadExtension(e){throw console.log("enableLoadExtension",e),this.unimplemented("Not implemented on web.")}})}}});